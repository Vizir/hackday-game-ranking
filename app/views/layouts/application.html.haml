!!!
%html.no-js
  %head
    %meta{:charset => "utf-8"}/
    %meta{:content => "IE=edge,chrome=1", "http-equiv" => "X-UA-Compatible"}/
    %title
    = stylesheet_link_tag    "application", :media => "all"
    = javascript_include_tag "application"
    = csrf_meta_tags
    %meta{:name=>"apple-mobile-web-app-capable", :content=>"yes"}/
    %meta{:name=>"apple-mobile-web-app-status-bar-style", :content=>"black"}/
    %meta{:content => "", :name => "description"}/
    %meta{:content => "width=device-width, initial-scale=1", :name => "viewport"}/
    :javascript
      $(document).ready(function() {
        
        var windowHeight = $(window).height();
        var headerHeight = $('header').height();
        var footerHeight = $('footer').height();

          if($(window).width() <= 1024){
              $("#novo-ranking").html("+");
          } else {
              $("#novo-ranking").html("Novo Ranking");
          }

          $('#goto-ranking').click(function(){
              $('#timeline').fadeOut()
              $('#ranking').fadeIn()
              return false
          })

          $('#goto-timeline').click(function(){
              $('#ranking').fadeOut()
              $('#timeline').fadeIn()
              return false
          })

          $('.nova-partida').click(function(){
              var $this = $(this).parents('.ranking-row');
              $('#jogador-visitante').val($this.find('#username').text());
              $('#jogador-visitante-id').val($this.prop('id'));

              $.ajax({
                url: 'teams/get_new_score_data/' + #{current_player.try(:id)} + '/' + $this.prop('id'),
                success: function(data){
                  if(data.last_team_player1 != null){
                    $('#time-casa').val(data.last_team_player1.name);
                    $("#game_player1_team_logo").attr('src', data.last_team_player1.logo)
                    $('#game_player1_team_id').val(data.last_team_player1.id);
                  }
                  if(data.last_team_player2 != null){
                    $('#time-visitante').val(data.last_team_player2.name);
                    $("#game_player2_team_logo").attr('src', data.last_team_player2.logo)
                    $('#game_player2_team_id').val(data.last_team_player2.id);
                  }
                  set_team_autocomplete(data.all_teams);

                  $('#modal').fadeIn('fast')
                  $('#modal-bg').fadeIn('fast')
                  if($(window).width() <= 1024){
                    $('header, footer, #wrapper').hide();
                  }

                },
                error: function(){
                  alert("Erro ao carregar os times");
                }
              });
              return false
          })

          $('#close').click(function(){
              $('#modal').fadeOut('fast')
              $('#modal-bg').fadeOut('fast', function(){
                $('header, footer, #wrapper').fadeIn('fast');            
              })
              return false
          })

          $(window).resize(function() {                
              if($(window).width() <= 1024){
                  $("#novo-ranking").html("+");
                  $('#timeline').fadeOut()
              } else {
                  $("#novo-ranking").html("Novo Ranking");
                  $('#ranking').fadeIn('fast');
                  $('#timeline').fadeIn('fast');
              }
          });

          // no Android, troca pra type=number pra mostrar teclado numerico.
          // (desculpa pela detecacao de user agent :)
          if (navigator.userAgent.indexOf('Android') >= 0) {
            $('.input-numerico').attr('type', 'number');
          }
        $(".input-numerico, .team_autocomplete").focus(function(){
          this.select();
        });
        
        $(".input-numerico, .team_autocomplete").mouseup(function(e){
          e.preventDefault();
        });
      });

      function set_team_autocomplete(teams){
        $( ".team_autocomplete" ).autocomplete({
          minLength: 0,
          source: teams,
          focus: function( event, ui ) {
            $(this).val( ui.item.label );
            $("#game_" + $(this).attr('name') + "_logo").attr('src', ui.item.logo)
            return false;
          },
          select: function( event, ui ) {
            $(this).val( ui.item.label );
            $("#game_" + $(this).attr('name') + "_id").val(ui.item.value)
            $("#game_" + $(this).attr('name') + "_logo").attr('src', ui.item.logo)
            return false;
          }
        }).each(function(){
          $(this).data( "ui-autocomplete" )._renderItem = function( ul, item ) {
            return $( "<li>" )
              .append( "<a>" + "<img src='"+ item.logo + "'>" + item.label + " </a>" )
              .appendTo( ul );
          };
        });
      }

  %body
    - if !current_player.nil?
      = render '/home/resultado'
    %header
      %a#logo{:href => ""}
        %span Raking Fizir
      %h1 Ranking do Escritorio
      /%a#novo-ranking{:href => ""} Novo Ranking
      - if current_player.nil?
        = link_to('Entrar', new_player_session_path, :class=>'btn-sair')
      - else
        = link_to('Sair', destroy_player_session_path, :method => :delete, :class=>'btn-sair')
    #wrapper
      %section
        = yield
    %footer
      %a#goto-ranking{:href => ""} Ranking
      %a#goto-timeline{:href => ""} Timeline